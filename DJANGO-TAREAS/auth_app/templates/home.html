{% extends 'base.html' %}
{% load static %}
{% block content %}
    <div class="container-fluid h-100">
        <div class="row h-100 align-items-center justify-content-center">
            <div class="col-md-6">
                <div class="card mt-5">
                    <div class="card-body">
                        <h1 class="card-title text-center">Bienvenido a Listopia, {{user}}</h1>
                        <p class="card-text text-center">¡Crea listas de lo que quieras!</p>
                        <div class="text-center mt-4">
                           <a href="{% url 'create_list' %}" class="btn btn-primary btn-lg ml-3"><i class="fas fa-shopping-cart"></i>Comienza creando una lista</a>
                        </div>
                        <div class="mt-5">
                            <h2 class="text-center">Echa un vistazo a las listas publicadas por otros usuarios</h2>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th scope="col">Título</th>
                                        <th scope="col">Creador</th>
                                    </tr>
                                </thead>
                                <tbody id="public-lists">
                                    <!-- Lists will be loaded here via AJAX -->
                                </tbody>
                            </table>
                            <div class="text-center">
                                <button id="load-more" class="btn btn-secondary">Cargar más</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        let offset = 0;
        const limit = 10;

        function loadLists() {
            fetch(`/load_lists/?offset=${offset}&limit=${limit}`)
                .then(response => response.json())
                .then(data => {
                    const listsContainer = document.getElementById('public-lists');
                    data.lists.forEach(list => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td><a href="/list_details/${list.id}">${list.name}</a></td>
                            <td>
                                <a href="/user_details/${list.creator.username}" title="${list.creator.username}">
                                    <img src="../${list.creator.profile.pic}" class="rounded-circle border" alt="${list.creator.username}" style="width: 40px; height: 40px;">
                                </a>
                            </td>
                        `;
                        listsContainer.appendChild(row);
                    });
                    offset += limit;
                    if (!data.has_more) {
                        document.getElementById('load-more').style.display = 'none';
                    }
                });
        }

        document.getElementById('load-more').addEventListener('click', loadLists);

        // Initial load
        loadLists();
    </script>
{% endblock %}