{% extends 'base_exams.html' %}

{% block content %}
<div class="container"></div>
    <div class="row">
        <div class="col-md-6 border border-danger bg-light">
            <h2>Examen</h2>
            <p>{{exam.name}}</p>
            <p>{{exam.description}}</p>
            <p>{{exam.created_on}}</p>
            <p>{{exam.creator}}</p>
            <a class="btn btn-success" href="{% url 'add_question' exam_id=exam.id %}">Añadir Pregunta</a>
            <hr>

            {% for question in questions %}
            <p>{{question.name}}</p>
            {% endfor %}

            <hr>
          



            
        </div>        
        <div class="col-md-6 border border-danger bg-light">
            <h2>Panel de Administración</h2>
            

            <h4>Gestionar la Lista</h4>
        

            <h4>Colaboradores</h4>
            <a class="btn btn-success" href="#">Añadir Colaboradores</a>
            <a class="btn btn-secondary my-2" id="manage-items">Gestionar Preguntas</a>
            <a class="btn btn-secondary my-2" id="manage-tags">Gestionar ?</a>

                
        </div>
    </div>
</div>

<script>

        function manageItems() {
            const itemsHtml = `
                <form id="manage-items-form">
                    <table class="table">
                        <thead>
                            <tr>
                                <th scope="col">Seleccionar</th>
                                <th scope="col">Pregunta</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for question in questions %}
                            <tr>
                                <td><input type="checkbox" name="selected_question" value="{{ question.id }}"></td>
                                <td>{{ question.name }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </form>
            `;

            Swal.fire({
                title: 'Gestionar Items',
                html: itemsHtml,
                showCancelButton: true,
                confirmButtonText: 'Eliminar seleccionados',
                cancelButtonText: 'Cancelar',
                preConfirm: () => {
                    const selectedItems = Array.from(document.querySelectorAll('input[name="selected_items"]:checked')).map(cb => cb.value);
                    return selectedItems;
                }
            })
        }

        document.getElementById('manage-items').addEventListener('click', manageItems);
        

        function manageTags() {
            const tagsHtml = `
                <form id="manage-tags-form" method="post">
                    {% csrf_token %}
                    <table class="table">
                        <thead>
                            <tr>
                                <th scope="col">Tag</th>
                                <th scope="col">Seleccionar</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for tag in tags %}
                            <tr>
                                <td><div class='my-5 mx-4' style='background-color:{{tag.color}};'>{{ tag.name }}</div></td>
                                <td><input type="checkbox" name="selected_tags" value="{{ tag.id }}"></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <button type="submit" class="btn btn-danger">Eliminar seleccionados</button>
                </form>
            `;

            Swal.fire({
                title: 'Gestionar Tags',
                html: tagsHtml,
                showCancelButton: false,
                confirmButtonText: 'Ok',
                preConfirm: () => {
                    document.getElementById('manage-tags-form').submit();
                }
            });
        }

        document.getElementById('manage-tags').addEventListener('click', manageTags);
    
</script>

<script>
    function confirmarEnvio(event, form) {
        event.preventDefault(); // Prevents sending the form without confirmation

        Swal.fire({
            title: '¿Estás seguro?',
            html: '<span style="color: red;">Los cambios serán irreversibles.</span>',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Sí, enviar',
            cancelButtonText: 'Cancelar'
        }).then((result) => {
            if (result.isConfirmed) {
                form.submit();  // Sends the form if the user confirms the action
            }
        });
    }
</script>
{% endblock %}
